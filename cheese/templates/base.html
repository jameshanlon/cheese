{% macro render_form_field(f) -%}
  {{ f.label(class_="control-label") }}
  {% if f.description %}
    <p class="help-block">{{ f.description | safe}}</p>
  {% endif %}
  {% if f.type == "FileField" %}
    {{ f }}
  {% else %}
    {{ f(class_="form-control") }}
  {% endif %}
{%- endmacro %}

{% macro render_form(form, name, submit_description=None) -%}
<div id="{{name}}" style="padding-top:1.2em">
  <form method="POST" action="" enctype="multipart/form-data">
    {{ form.hidden_tag() if form.hidden_tag }}
    {% for f in form if f.type != 'CSRFTokenField' %}
      {% if f.errors %}
        <div class="form-group has-error">
          {{ render_form_field(f) }}
          {% for e in f.errors %}
            <span class="help-block">{{ e }}</span>
          {% endfor %}
        </div>
      {% else %}
        <div class="form-group">
          {{ render_form_field(f) }}
        </div>
      {% endif %}
    {% endfor %}
    <label></label>
    {% if submit_description %}<p>{{submit_description}}</p>{% endif %}
    <button class="btn" type="submit">Submit</button>
  </form>
</div>
{%- endmacro %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <title>The CHEESE Project Bristol</title>
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Droid+Sans'
          rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" href="/static/favicon.png">
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="user-navbar">
          {% if current_user.is_authenticated %}
            <div class="dropdown pull-right">
              <button class="btn btn-primary dropdown-toggle" type="button"
                      data-toggle="dropdown">{{current_user.email}}
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                {% if current_user.has_role('admin', 'manager', 'energy_tracer') %}
                  <li><a href="/energy-tracer-resources">Energy Tracer resources</a></li>
                {% endif %}
                {% if current_user.has_role('admin', 'manager') %}
                  <li><a href="{{url_for('admin.index')}}">CHEESE database</a></li>
                {% endif %}
                {% if current_user.has_role('admin') %}
                  <li><a href="{{url_for('user.invite')}}">Invite user</a></li>
                {% endif %}
                <li><a href="{{url_for('user.change_password')}}">Change password</a></li>
                <li><a href="{{url_for('user.logout')}}">Sign out</a></li>
              </ul>
            </div>
          {% else %}
            <div class="pull-right" style="font-size:0.8em">
              <a href="/user/sign-in">Login</a>
            </div>
          {% endif %}
        </div>
        <div style="text-align:center">
          <div id="logo"><img src="/static/images/title.png" width="500px"></div>
        </div>
        <nav class="navbar navbar-default" role="navigation">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle"
                    data-toggle="collapse" data-target=".navbar-ex1-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
          </div>
          <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
              <li><a href="/">Home</a></li>
              <li><a href="/blog">Blog</a></li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  Surveys <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="/home-surveys">
                        Information</a></li>
                  <li><a href="/apply-for-a-survey">
                        Apply</a></li>
                  <li><a href="/pre-survey-guide">
                        Information and preparation guide</a></li>
                  <li><a href="/cheese-box">
                        The CHEESE box</a></li>
                  <li><a href="/one-month-feedback">
                      One month feedback form</a></li>
                  <li><a href="/one-year-feedback">
                      One year feedback form</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  Get involved <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="/energy-tracer-training">
                        As an Energy Tracer surveyor</a></li>
                  <li><a href="/volunteering">
                        As a volunteer</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  About <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="/overview">
                        Overview</a></li>
                  <li><a href="/events">
                        Events</a></li>
                  <li><a href="/media-coverage">
                        Media coverage</a></li>
                  <li><a href="/management-and-funding">
                        Management and funding</a></li>
                  <li><a href="/faq">
                        FAQ</a></li>
                </ul>
              </li>
              <li><a href="http://www.heatview.co.uk">The Heatview map</a></li>
            </ul>
          </div>
        </nav>
      </div>
      <div id="imagemodal" class="modal fade" tabindex="-1" role="dialog"
           aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg" role="document">
          <div class="modal-content">
            <button type="button" class="close" data-dismiss="modal">
              <span aria-hidden="true">&times;</span>
              <span class="sr-only">Close</span>
            </button>
            <img src="" id="imagepreview">
            <div id="imagepreview-caption"></div>
          </div>
        </div>
      </div>
      <div class="content">
        {% with messages = get_flashed_messages() %}
          {% if messages %}
            {% for message in messages %}
              <div class="alert alert-success">{{ message }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}
        {% block content %}{% endblock %}
      </div>
      <footer>
        <hr>
        <div id="footer-right">
        <small>
        Our partner organisations:<br>
        <ul>
          <li><a href="http://www.bristolenergynetwork.org">
              Bristol Energy Network</a></li>
          <li><a href="http://www.ambitionlw.org">
              Ambition Lawrence Weston</a></li>
          <li><a href="http://www.eastonenergygroup.org">
              Easton Energy Group</a></li>
          <li><a href="https://www.facebook.com/BCR.EnergyGroup">
              Bishopston, Cotham, Redland Energy Group</a></li>
          <li><a href="https://transitionmalvernhills.org.uk">
              Transition Malvern Hills</a></li>
          <li><a href="https://sites.google.com/site/reworkltd/">
              Re:work</a></li>
        </ul>
        </small>
        </div>
        <div id="footer-left">
          <p><small>The CHEESE project is a Bristol-based not-for-profit
          community enterprise that aims to reduce energy bills, improve health
          and wellbeing, and reduce our carbon emissions.</small></p>
          <p>
          <ul>
            <li><a href="mailto:info@cheeseproject.co.uk">
                info@cheeseproject.co.uk</a></li>
            <li><a href="http://www.twitter.com/CHEESEBristol/">
                @CHEESEBristol</a></li>
          </ul>
          </p>
          <small>
            <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
              <img alt="Creative Commons License" style="border-width:0"
                   src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" />
            </a><br />All content, unless otherwise stated, is licensed under a
              <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
              Creative Commons Attribution-ShareAlike 4.0 International License</a>.
          </small>
        </div>
        </div>
      </div>
    </footer>
    <script src="/static/js/jquery-3.1.1.min.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/main.js"></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-75834181-1', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>

version: '2'
services:
  nginx:
    restart: always
    build: nginx
    volumes:
      - .:/opt/www
    links:
      - cheese-flask
    ports:
      - "80:80"
  cheese-flask:
    restart: always
    build: flask
    links:
      - cheese-db
    expose:
      - "8000"
    volumes:
      - .:/opt/www
    environment:
      - CHEESE_SECRET_KEY=${CHEESE_SECRET_KEY}
      - CHEESE_MYSQL_HOST=${CHEESE_MYSQL_HOST}
      - CHEESE_MYSQL_DATABASE=${CHEESE_MYSQL_DATABASE}
      - CHEESE_MYSQL_USER=${CHEESE_MYSQL_USER}
      - CHEESE_MYSQL_PASSWORD=${CHEESE_MYSQL_PASSWORD}
      - CHEESE_SMTP_SERVER=${CHEESE_SMTP_SERVER}
      - CHEESE_SMTP_USERNAME=${CHEESE_SMTP_USERNAME}
      - CHEESE_SMTP_PASSWORD=${CHEESE_SMTP_PASSWORD}
      - CHEESE_SMTP_PORT=${CHEESE_SMTP_PORT}
      - CHEESE_SMTP_USE_SSL=${CHEESE_SMTP_USE_SSL}
      - CHEESE_SMTP_USE_TLS=${CHEESE_SMTP_USE_TLS}
      - CHEESE_EMAIL_SENDER=${CHEESE_EMAIL_SENDER}
      - CHEESE_APP_SYSTEM_ERROR_SUBJECT_LINE=${CHEESE_APP_SYSTEM_ERROR_SUBJECT_LINE}
      - CHEESE_ADMINS=${CHEESE_EMAIL_RECEIVER}
  cheese-db:
    image: mysql:8.0
    volumes:
      - ${CHEESE_MYSQL_DATA_DIR}:/var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=${CHEESE_MYSQL_ROOT_PASSWORD}
      - MYSQL_DATABASE=${CHEESE_MYSQL_DATABASE}
      - MYSQL_USER=${CHEESE_MYSQL_USER}
      - MYSQL_PASSWORD=${CHEESE_MYSQL_PASSWORD}

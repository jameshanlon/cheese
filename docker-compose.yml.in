version: '2'
services:
  nginx:
    restart: always
    build: nginx
    volumes:
      - .:/opt/www
    links:
      - cheese-flask
    ports:
      - "80:80"
  cheese-flask:
    restart: always
    build: flask
    links:
      - cheese-db
    expose:
      - "8000"
    volumes:
      - .:/opt/www
    environment:
      - CHEESE_SECRET_KEY=${CHEESE_SECRET_KEY}
      - CHEESE_CONTAINER_NAME=${CHEESE_CONTAINER_NAME}
      - CHEESE_SMTP_SERVER=${CHEESE_SMTP_SERVER}
      - CHEESE_SMTP_USERNAME=${CHEESE_SMTP_USERNAME}
      - CHEESE_SMTP_PASSWORD=${CHEESE_SMTP_PASSWORD}
      - CHEESE_SMTP_PORT=${CHEESE_SMTP_PORT}
      - CHEESE_SMTP_USE_SSL=${CHEESE_SMTP_USE_SSL}
      - CHEESE_SMTP_USE_TLS=${CHEESE_SMTP_USE_TLS}
      - CHEESE_EMAIL_SENDER=${CHEESE_EMAIL_SENDER}
      - CHEESE_MYSQL_HOST=${CHEESE_MYSQL_HOST}
      - CHEESE_MYSQL_ROOT_PASSWORD=${CHEESE_MYSQL_ROOT_PASSWORD}
      - CHEESE_MYSQL_DATABASE=${CHEESE_MYSQL_DATABASE}
      - CHEESE_MYSQL_USER=${CHEESE_MYSQL_USER}
      - CHEESE_MYSQL_PASSWORD=${CHEESE_MYSQL_PASSWORD}
      - CHEESE_WEBSITE_DIR=${CHEESE_WEBSITE_DIR}
      - CHEESE_CERTIFICATE_DIR=${CHEESE_CERTIFICATE_DIR}
      - CHEESE_ADMINS=${CHEESE_ADMINS}
      - CHEESE_WATCHERS=${CHEESE_WATCHERS}
      - CHEESE_S3_PREFIX=${CHEESE_S3_PREFIX}
      - CHEESE_S3_REGION=${CHEESE_S3_REGION}
      - CHEESE_S3_ENDPOINT_URL=${CHEESE_S3_ENDPOINT_URL}
      - CHEESE_S3_ACCESS_KEY_ID=${CHEESE_S3_ACCESS_KEY_ID}
      - CHEESE_S3_SECRET_ACCESS_KEY=${CHEESE_S3_SECRET_ACCESS_KEY}
  cheese-db:
    image: mysql:8.0.12
    volumes:
      - ${CHEESE_MYSQL_DATA_DIR}:/var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=${CHEESE_MYSQL_ROOT_PASSWORD}
      - MYSQL_DATABASE=${CHEESE_MYSQL_DATABASE}
      - MYSQL_USER=${CHEESE_MYSQL_USER}
      - MYSQL_PASSWORD=${CHEESE_MYSQL_PASSWORD}
